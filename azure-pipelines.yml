trigger:
  - main

pool:
  name: 'Default'

steps:
  # Cache Maven dependencies
  - task: Cache@2
    inputs:
      key: 'maven | "$(Agent.OS)" | **/pom.xml'
      restoreKeys: |
        maven | "$(Agent.OS)"
      path: ~/.m2/repository

  # Build Spring Boot directly with system Java
  - script: |
      export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
      export PATH=$JAVA_HOME/bin:$PATH
      mvn clean package -DskipTests
    displayName: 'Build Spring Boot with Maven'

  # Publish build artifact
  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: 'target'
      artifactName: 'springboot-artifact'
      publishLocation: 'Container'
